<!doctype html>
<html lang="en" class="h-full bg-gray-50">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Â· Taiko Quest NATC Phoenix 2025</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Runtime config (generated by Actions/Codespaces; do NOT commit) -->
  <script src="../config.js"></script>
</head>
<body class="h-full">
  <main class="max-w-6xl mx-auto p-4 sm:p-6">
    <!-- Header -->
    <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-6">
      <div class="flex items-center gap-3">
        <img src="../assets/branding/logo.svg" alt="TCA" class="h-8" onerror="this.style.display='none'">
        <div>
          <h1 class="text-2xl sm:text-3xl font-semibold text-gray-900">Admin</h1>
          <p class="text-sm text-gray-600">Taiko Quest NATC Phoenix 2025</p>
        </div>
      </div>

      <!-- Right side controls -->
      <div class="flex items-center gap-2">
        <span id="whoami" class="text-sm text-gray-600 hidden">Checking sessionâ€¦</span>
        <!-- Nav only when admin -->
        <nav id="nav" class="hidden">
          <a href="./questions.html" class="px-3 py-2 rounded-lg bg-gray-100 text-sm">Questions</a>
          <a href="./people.html" class="px-3 py-2 rounded-lg bg-gray-100 text-sm">People</a>
          <a href="./verifications.html" class="px-3 py-2 rounded-lg bg-gray-100 text-sm">Verifications</a>
        </nav>
        <!-- Auth buttons -->
        <button id="signin" class="px-3 py-2 rounded-lg bg-gray-900 text-white text-sm">Sign in</button>
        <button id="signout" class="px-3 py-2 rounded-lg bg-gray-200 text-gray-900 text-sm hidden">Sign out</button>
      </div>
    </header>

    <!-- Not admin notice -->
    <section id="noAccess" class="hidden">
      <div class="bg-amber-50 text-amber-900 ring-1 ring-amber-200 rounded-2xl p-4">
        <p class="text-sm">
          Youâ€™re signed in but donâ€™t have admin access for this site. If you believe this is an error,
          contact a coordinator to be added as an admin.
        </p>
      </div>
    </section>

    <!-- Dashboard cards (admin only) -->
    <section id="cards" class="hidden mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
      <!-- Questions -->
      <a href="./questions.html" class="group bg-white rounded-2xl shadow-sm ring-1 ring-black/5 p-5 flex flex-col gap-2 hover:shadow">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold">Questions</h2>
          <span class="text-xs text-gray-500">manage pool</span>
        </div>
        <p class="text-sm text-gray-600">Create, edit, activate or deactivate prompts.</p>
        <div class="mt-2 text-xs text-gray-500">Go to Questions â†’</div>
      </a>

      <!-- People -->
      <a href="./people.html" class="group bg-white rounded-2xl shadow-sm ring-1 ring-black/5 p-5 flex flex-col gap-2 hover:shadow">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold">People</h2>
          <span id="badgePending" class="hidden inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs bg-blue-50 text-blue-700 ring-1 ring-blue-200"></span>
        </div>
        <p class="text-sm text-gray-600">Approve registrations, promote admins, fix accounts.</p>
        <div class="mt-2 text-xs text-gray-500">Go to People â†’</div>
      </a>

      <!-- Verifications -->
      <a href="./verifications.html" class="group bg-white rounded-2xl shadow-sm ring-1 ring-black/5 p-5 flex flex-col gap-2 hover:shadow">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold">Verifications</h2>
          <span id="badgeUnv" class="hidden inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200"></span>
        </div>
        <p class="text-sm text-gray-600">Review attendee uploads and mark items as Verified.</p>
        <div class="mt-2 text-xs text-gray-500">Go to Verifications â†’</div>
      </a>
    </section>

    <!-- Signed-out landing -->
    <section id="signedOut" class="mt-6">
      <div class="bg-white rounded-2xl shadow-sm ring-1 ring-black/5 p-6">
        <h2 class="text-lg font-semibold mb-2">Welcome, coordinator ðŸ‘‹</h2>
        <p class="text-sm text-gray-700">Sign in with your TCA Google account to manage questions, people, and verifications.</p>
        <div class="mt-3">
          <button id="signin2" class="px-3 py-2 rounded-lg bg-gray-900 text-white text-sm">Sign in</button>
        </div>
      </div>
    </section>
  </main>

  <!-- App -->
  <script type="module">
    import {
      supaFromConfig,
      requireAdmin,
      signInGoogle,
      signOut,
      updateAuthUI
    } from '../js/admin-common.js'

    const supabase = supaFromConfig()
    const ADMIN_DOMAIN = '@taikocommunityalliance.org' // optional UI restriction; RLS still enforces

    // els
    const whoami = document.getElementById('whoami')
    const nav = document.getElementById('nav')
    const signin = document.getElementById('signin')
    const signout = document.getElementById('sign