import { renderHeader, initHeader, bindAuthButtons } from '../js/header.js'
import { supaFromConfig, requireAdmin, signInGoogle, signOut } from '../js/admin-common.js'

document.getElementById('siteHeader').outerHTML = renderHeader({
  admin: true,
  nav: [
    ['Admin','./index.html'],
    ['People','./people.html'],
    ['Verifications','./verifications.html'],
  ],
  withAuth: true
})
initHeader()

const supabase = supaFromConfig()

// ðŸ”’ Make the header buttons actually work (desktop + mobile)
bindAuthButtons({
  onSignIn: () => signInGoogle(supabase),
  onSignOut: () => signOut(supabase)
})

// (Optional) still grab desktop IDs if you pass them to requireAdmin for first paint
const whoami  = document.getElementById('whoami')
const signin  = document.getElementById('signin')
const signout = document.getElementById('signout')

// Keep your existing guard; updateAuthUI inside admin-common will flip labels too
const guard = await requireAdmin(supabase, /* ADMIN_DOMAIN */ null, {
  signinBtn: signin, signoutBtn: signout, whoami
})
if (!guard.admin) {
  // redirect if you want:
  // window.location.replace('../request.html')
  // return
}